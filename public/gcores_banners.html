<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Banners</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 240px;
            overflow: hidden;
            -webkit-tap-highlight-color:rgba(0,0,0,0);
        }
        a:focus, input:focus, p:focus, div:focus{
            -webkit-tap-highlight-color:rgba(0,0,0,0);
            -webkit-user-modify:read-write-plaintext-only;
        }
        #app {
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        .carousel {
            margin: 12px;
            width: calc(100% - 24px);
            height: 216px;
        }
        .carousel .el-carousel__container {
            height: 186px;
        }
        .carousel .el-carousel__container .image {
            width: 100%;
            height: 186px;
        }
    </style>
</head>
<body>
<div id="app">
    <el-carousel class="carousel" indicator-position="outside" trigger="click" arrow="always">
        <el-carousel-item v-for="(item, index) in imageList" :key="index">
            <el-image class="image" :src="item.src" fit="cover" @click="imageClickHandle(index)"></el-image>
        </el-carousel-item>
    </el-carousel>
</div>
<script src="./js/vue.min.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                imageList: []
            }
        },
        created() {
            eval(fba.getInternalJs());
            const saveTime = localStorage.getItem('time') || 0
            if (new Date().getTime() - parseInt(saveTime) > 1000*60*60*2)
                this.initData()
            else
                this.initImageList()
        },
        methods: {
            initImageList() {
                this.imageList = JSON.parse(localStorage.getItem('imageList'))
            },
            initData() {
                const html = request("https://www.gcores.com")
                const json = fba.parseDomForArray(html, '.focusImages&&.focusImages_item')
                const arr = JSON.parse(json)
                let list = []
                arr.forEach(item => {
                    let href = fba.parseDomForHtml(item, '.focusImages_item&&href')
                    const [type, id] = href.split('/').filter(item => item)
                    list.push({
                        src: item.match(/url\((.*?)\)/)[1],
                        url: 'https://www.gcores.com'+href,
                        type: type,
                        id: id,
                    })
                })
                localStorage.setItem('imageList', JSON.stringify(list))
                localStorage.setItem('time', new Date().getTime().toString())
                this.imageList = list
            },
            imageClickHandle(index) {
                const bannerItem = this.imageList[index]
                let detailRule = 'js:' + $$$.toString(bannerItem => {
                    eval(fetch('https://git.tyrantg.com/tyrantgenesis/hikerViewRules/raw/master/COLLECTION/gcores.js'))
                    gcores.x5SubUrlBuild(bannerItem)
                }, bannerItem)
                let url = bannerItem.url+"#immersiveTheme#" //#fypage
                switch (bannerItem.type) {
                    default: break
                    case 'albums': url += '#fypage';break
                }
                fy_bridge_app.toDetailPage('详情', url, '', '', detailRule, '')
            },
        },
    });
</script>
</body>
</html>