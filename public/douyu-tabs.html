<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>TyrantGenesis 自制组件</title>
    <link rel="stylesheet" href="./css/element-ui.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 48px;
            overflow: hidden;
        }
        #app {
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
        .tab {
            margin: 12px auto;
        }
    </style>
</head>
<body>
<div id="app">
    <el-radio-group class="tab" v-model="value" @change="switchTab" size="mini">
        <el-radio-button :label="item.id" v-for="item in tabs" :key="item.id">{{item.title}}</el-radio-button>
    </el-radio-group>
</div>
<script src="./js/vue.min.js"></script>
<script src="./js/element-ui.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                value: 0,
                tabs: [
                    {id: 0, title: '热门直播'},
                    {id: 1, title: '所有分类'},
                ]
            }
        },
        methods: {
            switchTab(num) {
                if (num === 1) {
                    this.value = 0
                    const title = this.getQueryVariable('title')
                    let detailRule = 'js:' + $$$.toString(params => {
                        let d = []
                        let list_json = fetch(MY_URL)
                        let list = JSON.parse(list_json).data
                        list.cate2Info.forEach(cate2 => {
                            let category_url = "https://m.douyu.com/api/room/list?page=fypage&type="+cate2.shortName
                            d.push({
                                title:cate2.cate2Name,
                                pic_url:cate2.icon,
                                url: $(category_url).rule(params => {
                                    let d = []
                                    const html = getResCode();
                                    const list = JSON.parse(html).data

                                    list.list.forEach(item => {
                                        d.push({
                                            title: item.roomName,
                                            desc: item.nickname,
                                            pic_url: item.roomSrc,
                                            url: $("https://m.douyu.com/"+item.rid).lazyRule(params => {
                                                const { getSign } = $$$.require('hiker://page/utils?rule='+params.title)

                                                const html = fetch(input)

                                                const rid = parseInt(input.replace("https://m.douyu.com/", ""))
                                                const tt = Date.parse(new Date()).toString().substr(0,10)
                                                const did = "10000000000000000000000000001501"

                                                let param_body = getSign(html, rid, did, tt)

                                                const stream_json = fetch('https://m.douyu.com/api/room/ratestream', {headers:{'content-type':'application/x-www-form-urlencoded'}, body: param_body, method:'POST'})
                                                const stream = JSON.parse(stream_json).data

                                                return stream.url
                                            }, {
                                                title: params.title
                                            }),
                                            col_type: 'movie_2'
                                        })
                                    })

                                    setResult(d);
                                }, {
                                    title: params.title
                                }),
                                col_type:"icon_round_4"
                            });
                        });
                        setResult(d);
                    }, {
                        title: title
                    })

                    fy_bridge_app.toDetailPage('所有分类', "https://m.douyu.com/api/cate/list", '', '', detailRule, '')
                }
            },
            getQueryVariable(variable) {
                let query = window.location.search.substring(1)
                let vars = query.split("&");
                for (let i=0;i<vars.length;i++) {
                    let pair = vars[i].split("=");
                    if(pair[0] === variable) return decodeURIComponent(pair[1])
                }
                return false
            }
        },
    });
</script>
</body>
</html>